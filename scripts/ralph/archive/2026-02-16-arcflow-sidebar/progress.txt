# Ralph Progress Log
Started: Sun Feb 16 2026
Branch: ralph/v1.1-delight-stickiness

## Codebase Patterns
- Tailwind CSS v4 uses `@import "tailwindcss"` instead of `@tailwind` directives
- Dark mode uses Tailwind `class` strategy via `tailwind.config.ts`
- Vite builds Chrome extension with multi-entry: sidepanel HTML + service-worker TS
- manifest.json lives in `public/` and is copied to `dist/` by a custom Vite plugin
- Side panel HTML path in manifest must match Vite's output: `src/sidepanel/index.html`
- ESLint 9 flat config in `eslint.config.js` (not .eslintrc)
- All data model types in `src/shared/types.ts`
- Chrome types via `@types/chrome` devDependency
- Prettier checks only `src/**/*.{ts,tsx,css,html}` to avoid .gitkeep issues
- Message types (ServiceWorkerMessage, SidePanelMessage, TabInfo) defined in `src/shared/types.ts`
- Service worker broadcasts tab changes via `chrome.runtime.sendMessage`; side panel listens via `chrome.runtime.onMessage`
- `chrome.runtime.sendMessage` throws if no listener exists (e.g., side panel closed); always `.catch()` the promise
- Side panel communicates tab actions (close, etc.) via message passing to service worker which has `chrome.tabs` access
- Theme managed via `useTheme` hook in `src/sidepanel/useTheme.ts`; applies `dark` class to `<html>` element
- Theme preference stored in `chrome.storage.local` under `settings.theme` key
- Sidebar footer (Zone 5) pushed to bottom via `flex-1` on the content area
- `chrome.storage.onChanged` listener pattern for real-time UI updates when storage changes
- Origin matching for URL comparison: `new URL(url).origin` (wrap in try/catch for invalid URLs)
- Context menus use a shared `ContextMenu` component in `src/sidepanel/ContextMenu.tsx` — rendered at App level, state lifted via `setContextMenu`
- In-sidebar context menus use `onContextMenu` React handler (not `chrome.contextMenus` API which is for page-level context menus)
- Drag-and-drop uses `@dnd-kit/core` + `@dnd-kit/sortable` + `@dnd-kit/utilities`; PointerSensor with `distance: 5` prevents accidental drags from clicks
- Chrome context menus (`chrome.contextMenus.create`) must be registered inside `chrome.runtime.onInstalled` listener; use `chrome.contextMenus.update` for dynamic title changes
- Folder storage helpers in `src/shared/folderStorage.ts`; pinned apps storage in `src/shared/storage.ts`
- Nesting depth validation: traverse parentId chain counting ancestors; reject at depth >= 3
- DnD across components (tabs → folders): use a single `DndContext` at App level wrapping both FolderTree and tab list; use ID prefixes (`tab:`, `folder:`, `folder-item:`, `folder-drop:`) to distinguish drag/drop types in `onDragEnd`
- Folder state (folders, setFolders) lifted to App level for cross-component DnD; FolderTree receives folders/setFolders as props
- Workspace storage in `src/shared/workspaceStorage.ts`; schema versioned (currently v2)
- Per-workspace data: each workspace has its own pinnedApps[] and folders[] arrays
- Tab-workspace mapping: `tabWorkspaceMap` in storage tracks tabId → workspaceId
- Settings storage in `src/shared/settingsStorage.ts`; auto-save on change pattern
- Command palette in `src/sidepanel/CommandPalette.tsx`; command registry is an array of { id, name, icon, action }
- Session data in `src/shared/sessionStorage.ts`; sessions capture full workspace snapshot
- Onboarding in `src/sidepanel/Onboarding.tsx`; tracked via `onboardingCompleted` boolean in storage
---
