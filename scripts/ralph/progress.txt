# Ralph Progress Log
Started: Sun Feb 15 15:44:51 IST 2026

## Codebase Patterns
- Tailwind CSS v4 uses `@import "tailwindcss"` instead of `@tailwind` directives
- Dark mode uses Tailwind `class` strategy via `tailwind.config.ts`
- Vite builds Chrome extension with multi-entry: sidepanel HTML + service-worker TS
- manifest.json lives in `public/` and is copied to `dist/` by a custom Vite plugin
- Side panel HTML path in manifest must match Vite's output: `src/sidepanel/index.html`
- ESLint 9 flat config in `eslint.config.js` (not .eslintrc)
- All data model types in `src/shared/types.ts`
- Chrome types via `@types/chrome` devDependency
- Prettier checks only `src/**/*.{ts,tsx,css,html}` to avoid .gitkeep issues
- Message types (ServiceWorkerMessage, SidePanelMessage, TabInfo) defined in `src/shared/types.ts`
- Service worker broadcasts tab changes via `chrome.runtime.sendMessage`; side panel listens via `chrome.runtime.onMessage`
- `chrome.runtime.sendMessage` throws if no listener exists (e.g., side panel closed); always `.catch()` the promise
- Side panel communicates tab actions (close, etc.) via message passing to service worker which has `chrome.tabs` access
- Theme managed via `useTheme` hook in `src/sidepanel/useTheme.ts`; applies `dark` class to `<html>` element
- Theme preference stored in `chrome.storage.local` under `settings.theme` key
- Sidebar footer (Zone 5) pushed to bottom via `flex-1` on the content area
- `chrome.storage.onChanged` listener pattern for real-time UI updates when storage changes
- Origin matching for URL comparison: `new URL(url).origin` (wrap in try/catch for invalid URLs)
- Context menus use a shared `ContextMenu` component in `src/sidepanel/ContextMenu.tsx` — rendered at App level, state lifted via `setContextMenu`
- In-sidebar context menus use `onContextMenu` React handler (not `chrome.contextMenus` API which is for page-level context menus)
- Drag-and-drop uses `@dnd-kit/core` + `@dnd-kit/sortable` + `@dnd-kit/utilities`; PointerSensor with `distance: 5` prevents accidental drags from clicks
- Chrome context menus (`chrome.contextMenus.create`) must be registered inside `chrome.runtime.onInstalled` listener; use `chrome.contextMenus.update` for dynamic title changes
- Folder storage helpers in `src/shared/folderStorage.ts`; pinned apps storage in `src/shared/storage.ts`
- Nesting depth validation: traverse parentId chain counting ancestors; reject at depth >= 3
- DnD across components (tabs → folders): use a single `DndContext` at App level wrapping both FolderTree and tab list; use ID prefixes (`tab:`, `folder:`, `folder-item:`, `folder-drop:`) to distinguish drag/drop types in `onDragEnd`
- Folder state (folders, setFolders) lifted to App level for cross-component DnD; FolderTree receives folders/setFolders as props
- Custom collision detection: `pointerWithin` for folder drop targets, `rectIntersection` fallback for sortable items
- Fuzzy search uses `fuse.js` with keys `title` (weight 0.6), `url` (weight 0.3), `folderName` (weight 0.1); threshold 0.4
- React hooks lint rule `react-hooks/set-state-in-effect` disallows calling setState directly inside useEffect body; instead call it inside a setTimeout/callback
- Workspace storage in `src/shared/workspaceStorage.ts`; keys: `workspaces`, `activeWorkspaceId`, `schemaVersion`, `tabWorkspaceMap`
- Default workspace (id: "default") created on first install; cannot be deleted or renamed
- Tab-to-workspace mapping stored as `Record<string, string>` (tabId as string key → workspaceId)
- `ensureInitialized()` pattern: check if storage key exists before first use, create defaults if missing
---

## Iteration 1 - Sun Feb 15 15:44:52 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260215-154451/iter-1.log
---
Error: Claude Code cannot be launched inside another Claude Code session.
Nested sessions share runtime resources and will crash all active sessions.
To bypass this check, unset the CLAUDECODE environment variable.
⚠️  timeout failed with ITER_TIMEOUT='1200'. Running without timeout.
Error: Claude Code cannot be launched inside another Claude Code session.
Nested sessions share runtime resources and will crash all active sessions.
To bypass this check, unset the CLAUDECODE environment variable.
---

## Iteration 2 - Sun Feb 15 15:44:54 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260215-154451/iter-2.log
---
Error: Claude Code cannot be launched inside another Claude Code session.
Nested sessions share runtime resources and will crash all active sessions.
To bypass this check, unset the CLAUDECODE environment variable.
⚠️  timeout failed with ITER_TIMEOUT='1200'. Running without timeout.
Error: Claude Code cannot be launched inside another Claude Code session.
Nested sessions share runtime resources and will crash all active sessions.
To bypass this check, unset the CLAUDECODE environment variable.
---

## Iteration 3 - Sun Feb 15 15:44:56 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260215-154451/iter-3.log
---
Error: Claude Code cannot be launched inside another Claude Code session.
Nested sessions share runtime resources and will crash all active sessions.
To bypass this check, unset the CLAUDECODE environment variable.
⚠️  timeout failed with ITER_TIMEOUT='1200'. Running without timeout.
Error: Claude Code cannot be launched inside another Claude Code session.
Nested sessions share runtime resources and will crash all active sessions.
To bypass this check, unset the CLAUDECODE environment variable.
---

## 2026-02-15 15:49 IST - US-001
- Implemented full project scaffolding: Vite + React 18 + TypeScript + Tailwind CSS v4 + Chrome Manifest V3
- Files created:
  - package.json (with dev, build, typecheck, lint scripts)
  - tsconfig.json (strict mode enabled)
  - tailwind.config.ts (dark mode class strategy)
  - vite.config.ts (multi-entry build for sidepanel + service-worker)
  - eslint.config.js + .prettierrc
  - public/manifest.json (MV3 with sidePanel, tabs, storage, contextMenus)
  - src/shared/types.ts (Workspace, PinnedApp, Folder, FolderItem, ArchiveEntry, Settings)
  - src/sidepanel/ (index.html, main.tsx, App.tsx, index.css)
  - src/background/service-worker.ts
  - src/content/.gitkeep
  - .gitignore
- **Learnings for future iterations:**
  - Tailwind v4 uses `@import "tailwindcss"` not `@tailwind base/components/utilities`
  - ESLint 9 uses flat config format, not .eslintrc
  - Vite service-worker entry produces empty chunk (expected, will fill in US-002/003)
  - manifest.json side_panel path must match Vite output: `src/sidepanel/index.html` not `sidepanel.html`
  - eslint-plugin-react-hooks v7 needs eslint@9 specifically (not 10)
  - Node 20.12 shows version warnings with Vite 7 but builds successfully
---

## Iteration 1 - Sun Feb 15 15:51:19 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260215-154616/iter-1.log
---
US-001 is complete. There are still stories with `passes: false` (US-002 through US-041), so the next iteration will pick up US-002.

**Summary of US-001 completion:**
- Created branch `ralph/arcflow-sidebar`
- Scaffolded complete project: Vite + React 18 + TypeScript + Tailwind CSS v4 + Chrome MV3
- All acceptance criteria met:
  - `package.json` with all required dependencies
  - `manifest.json` with MV3, sidePanel, tabs, storage, contextMenus
  - `tsconfig.json` with strict mode
  - Tailwind with dark mode class strategy
  - Source structure: `src/sidepanel/`, `src/background/`, `src/shared/`, `src/content/`
  - All data model interfaces in `src/shared/types.ts`
  - Build produces loadable `dist/` folder
  - ESLint + Prettier with `npm run lint`
  - Typecheck passes
---

## 2026-02-15 - US-002
- Implemented side panel registration and basic React rendering
- Files changed:
  - src/background/service-worker.ts (added sidePanel registration and setPanelBehavior)
- **Learnings for future iterations:**
  - `chrome.sidePanel.setPanelBehavior({ openPanelOnActionClick: true })` should be called at top level of service worker, not inside a listener
  - `chrome.sidePanel.setOptions()` called inside `onInstalled` to set the panel path
  - The side panel HTML, main.tsx, and App.tsx were already created in US-001 scaffolding
  - Service worker just needed the chrome.sidePanel API calls to complete this story
---

## Iteration 2 - Sun Feb 15 15:53:05 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260215-154616/iter-2.log
---
US-002 is complete. There are still stories with `passes: false` (US-003 through US-041), so the next iteration will pick up US-003.

**Summary of US-002 completion:**
- Updated `src/background/service-worker.ts` to register the side panel via `chrome.sidePanel.setOptions()` on install and set `openPanelOnActionClick: true` for toolbar icon toggle
- All acceptance criteria met:
  - `src/sidepanel/index.html` exists as side panel entry point (from US-001)
  - `src/sidepanel/main.tsx` renders React root (from US-001)
  - `src/sidepanel/App.tsx` renders basic layout with ArcFlow header (from US-001)
  - Service worker registers side panel via `chrome.sidePanel.setOptions()`
  - Service worker calls `chrome.sidePanel.setPanelBehavior({ openPanelOnActionClick: true })`
  - Clicking toolbar icon toggles side panel
  - Typecheck passes
- Committed as `cfb8ee6`
---

## 2026-02-15 - US-003
- Implemented service worker tab event listeners and state broadcasting
- Files changed:
  - src/background/service-worker.ts (added tab lifecycle listeners, debouncing, persistence, broadcasting)
  - src/shared/types.ts (added TabInfo, ServiceWorkerMessage, SidePanelMessage types)
  - src/sidepanel/App.tsx (added message listener and React state for tab list)
- **Learnings for future iterations:**
  - `chrome.runtime.sendMessage()` returns a promise that rejects if no listener is registered (e.g., side panel not open). Always `.catch()` it.
  - Debouncing with `setTimeout` in service workers works but the timer may be cleared if the worker is terminated. State persistence to `chrome.storage.local` provides the safety net.
  - Side panel can request initial tabs via `GET_TABS` message with `sendResponse` pattern (return `true` from listener for async response).
  - `chrome.tabs.query({ currentWindow: true })` returns tabs for the window context the service worker is associated with.
---

## Iteration 3 - Sun Feb 15 15:56:13 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260215-154616/iter-3.log
---
US-003 is complete. There are still stories with `passes: false` (US-004 through US-041), so the next iteration will pick up US-004.

**Summary of US-003 completion:**
- Added `TabInfo`, `ServiceWorkerMessage`, and `SidePanelMessage` types to `src/shared/types.ts`
- Updated `src/background/service-worker.ts` with:
  - Tab lifecycle listeners: `onCreated`, `onRemoved`, `onActivated`, `onUpdated`, `onMoved`
  - Startup tab query via `chrome.tabs.query({ currentWindow: true })`
  - 50ms debounced refresh for batching rapid changes
  - Broadcasting via `chrome.runtime.sendMessage`
  - Persistence to `chrome.storage.local` under `tabList` key
  - `GET_TABS` message handler for side panel requests
- Updated `src/sidepanel/App.tsx` with:
  - `chrome.runtime.onMessage` listener for `TABS_UPDATED` and `TAB_ACTIVATED`
  - Initial tab load via `GET_TABS` message + storage fallback
  - Basic tab list rendering with favicons
- All checks pass (typecheck, lint, build)
- Committed as `817bf2f`
---

## 2026-02-15 - US-004
- Implemented tab list display with favicons, titles, and close buttons
- Files changed:
  - src/sidepanel/App.tsx (refactored into TabItem component with hover close button, placeholder search bar, proper 32px height and 4px gap)
  - src/shared/types.ts (added CLOSE_TAB to SidePanelMessage union)
  - src/background/service-worker.ts (added CLOSE_TAB message handler)
- **Learnings for future iterations:**
  - TabItem extracted as a separate component for per-item hover state management
  - Favicon fallback: use an empty gray placeholder div when favIconUrl is missing; add onError handler to hide broken images
  - Close tab from side panel uses message passing (CLOSE_TAB -> service worker -> chrome.tabs.remove) since side panel doesn't have direct chrome.tabs access
  - `gap-1` in Tailwind = 4px gap between flex children
---

## Iteration 4 - Sun Feb 15 15:58:12 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260215-154616/iter-4.log
---
**US-004 is complete.** Here's what was implemented:

- **TabItem component** with favicon (16x16), truncated title, and close button (X) that appears on hover
- **Placeholder search bar** area above the tab list
- **Tab items are 32px tall** (`h-8`) with **4px gap** (`gap-1`) between items
- **CLOSE_TAB message** added to side panel → service worker communication, enabling tab closure from the sidebar
- **Favicon fallback** with gray placeholder when no favicon URL is available, plus `onError` handler for broken images
- All quality checks pass (typecheck, lint, build)
- Committed as `91187dc`

There are still stories with `passes: false` (US-005 through US-041), so the next iteration will pick up US-005.
---

## 2026-02-15 - US-005
- Implemented tab switching and active tab indicator
- Files changed:
  - src/shared/types.ts (added SWITCH_TAB to SidePanelMessage union)
  - src/background/service-worker.ts (added SWITCH_TAB handler calling chrome.tabs.update)
  - src/sidepanel/App.tsx (added click handler on TabItem, active tab styling with 3px #2E75B6 left border and bold text)
- **Learnings for future iterations:**
  - Active tab styling uses `border-l-[3px] border-l-[#2E75B6]` with a matching transparent border on inactive tabs to prevent layout shift
  - Tab switching follows same message-passing pattern as tab close: side panel -> SWITCH_TAB message -> service worker -> chrome.tabs.update
  - Active state already tracked in TabInfo from US-003 (TAB_ACTIVATED message), so no additional state management was needed
---

## Iteration 5 - Sun Feb 15 16:00:09 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260215-154616/iter-5.log
---
**US-005 is complete.** Here's what was implemented:

- **Tab switching**: Clicking a tab in the sidebar sends a `SWITCH_TAB` message to the service worker, which calls `chrome.tabs.update(tabId, { active: true })`
- **Active tab indicator**: Active tab displays with a 3px `#2E75B6` left border and bold text; inactive tabs have a transparent border to prevent layout shift
- **Bidirectional sync**: Already handled via `TAB_ACTIVATED` messages from US-003 — switching tabs via Chrome's native tab bar updates the sidebar highlight

All quality checks pass (typecheck, lint, build). Committed as `10c7ace`.

There are still stories with `passes: false` (US-006 through US-041), so the next iteration will pick up US-006.
---

## 2026-02-15 - US-006
- Implemented middle-click to close tabs from the sidebar
- Files changed:
  - src/sidepanel/App.tsx (added onMouseDown handler for middle-click close)
- **Learnings for future iterations:**
  - Most of US-006 was already implemented in US-004 (hover close button, CLOSE_TAB message, chrome.tabs.remove)
  - Middle-click is `e.button === 1` in React's MouseEvent; use `onMouseDown` not `onClick` since middle-click doesn't fire click events
  - `e.preventDefault()` on middle-click prevents the browser's default paste/scroll behavior
---

## Iteration 6 - Sun Feb 15 16:01:16 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260215-154616/iter-6.log
---
**US-006 is complete.** Here's what was implemented:

- **Middle-click to close**: Added `onMouseDown` handler on tab entries that detects middle-click (`e.button === 1`) and sends the `CLOSE_TAB` message to the service worker
- The hover close button (X icon, 16x16) and `chrome.tabs.remove` via message passing were already implemented in US-004/US-005
- All quality checks pass (typecheck, lint, build)
- Committed as `4e9a0de`

There are still stories with `passes: false` (US-007 through US-041), so the next iteration will pick up US-007.
---

## 2026-02-15 - US-007
- Implemented light/dark theme support with system preference detection
- Files changed:
  - src/sidepanel/useTheme.ts (new - theme hook with system detection, persistence, cycling)
  - src/sidepanel/App.tsx (added footer with theme toggle button, integrated useTheme hook)
- **Learnings for future iterations:**
  - Theme is applied by toggling `dark` class on `document.documentElement` (Tailwind class strategy)
  - Theme preference stored in `chrome.storage.local` under key `settings.theme` with values `system | light | dark`
  - `useTheme` hook in `src/sidepanel/useTheme.ts` provides `theme`, `setTheme`, and `cycleTheme`
  - System theme changes detected via `window.matchMedia("(prefers-color-scheme: dark)")` change event listener
  - Footer is in Zone 5 of the sidebar layout; uses `flex-1` on the content area to push footer to bottom
  - Theme toggle cycles: system -> light -> dark -> system
---

## Iteration 7 - Sun Feb 15 16:04:05 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260215-154616/iter-7.log
---
**US-007 is complete.** Here's what was implemented:

- **`src/sidepanel/useTheme.ts`** - New hook that:
  - Defaults to system preference via `prefers-color-scheme` media query
  - Listens for system theme changes in real-time
  - Persists theme preference to `chrome.storage.local` under `settings.theme`
  - Applies theme by toggling `dark` class on `<html>` (Tailwind class strategy)
  - Cycles through system -> light -> dark

- **`src/sidepanel/App.tsx`** - Updated with:
  - `ThemeToggle` component with sun/moon/monitor icons for each mode
  - Footer section (Zone 5) with theme toggle button
  - Layout restructured with `flex-1` on content to push footer to bottom
  - All existing `dark:` variants now functional

- **Acceptance criteria met:**
  - System preference detection via `prefers-color-scheme`
  - Light: gray-50 background, gray-900 text / Dark: gray-900 background, gray-100 text
  - Theme stored in `chrome.storage.local` under `settings.theme`
  - Manual toggle in sidebar footer cycles system/light/dark
  - Instant theme changes without reload
  - Persists across browser restarts
  - All UI elements adapt (already had `dark:` variants)
  - Tailwind `dark:` variant with class strategy
  - Typecheck, lint, and build all pass

There are still stories with `passes: false` (US-008 through US-041), so the next iteration will pick up US-008.
---

## 2026-02-15 - US-008
- Implemented Chrome storage helpers for pinned apps CRUD
- Files created:
  - src/shared/storage.ts (getPinnedApps, addPinnedApp, removePinnedApp, updatePinnedApp, reorderPinnedApps)
- **Learnings for future iterations:**
  - `chrome.storage.local.get()` returns `Record<string, unknown>` so cast result with `as PinnedApp[] | undefined` for type safety
  - Storage key is `pinnedApps` in `chrome.storage.local`
  - Maximum 12 pinned apps enforced in `addPinnedApp` — throws Error if limit reached
  - `getPinnedApps()` sorts by `sortOrder` before returning
  - `reorderPinnedApps(ids)` takes an array of IDs in desired order and assigns sequential sortOrder values
---

## Iteration 8 - Sun Feb 15 16:05:57 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260215-154616/iter-8.log
---
**US-008 is complete.** Here's what was implemented:

- **`src/shared/storage.ts`** — New module with 5 exported functions:
  - `getPinnedApps()` — Retrieves pinned apps sorted by sortOrder
  - `addPinnedApp(app)` — Adds a pinned app, rejects if 12-app limit reached
  - `removePinnedApp(id)` — Removes a pinned app by ID
  - `updatePinnedApp(id, data)` — Partially updates a pinned app
  - `reorderPinnedApps(ids)` — Reorders apps by an array of IDs

- All acceptance criteria met:
  - Stored in `chrome.storage.local` under key `pinnedApps`
  - PinnedApp shape: `{ id, url, title, favicon, sortOrder }`
  - All functions return Promises
  - Maximum 12 pinned apps enforced
  - Typecheck and lint pass

- Committed as `233053f`

There are still stories with `passes: false` (US-009 through US-041), so the next iteration will pick up US-009.
---

## 2026-02-15 - US-009
- Implemented pinned apps row UI with display and click-to-switch
- Files created:
  - src/sidepanel/PinnedAppsRow.tsx (new component for pinned apps horizontal row)
- Files changed:
  - src/shared/types.ts (added OPEN_PINNED_APP to SidePanelMessage union)
  - src/background/service-worker.ts (added OPEN_PINNED_APP handler with origin matching)
  - src/sidepanel/App.tsx (imported and placed PinnedAppsRow in Zone 2)
  - src/sidepanel/index.css (added scrollbar-none utility class)
- **Learnings for future iterations:**
  - PinnedAppsRow listens to `chrome.storage.onChanged` for real-time updates when pinned apps are added/removed
  - Origin matching uses `new URL(url).origin` to find existing tabs before opening new ones
  - Active indicator is a 6px (w-1.5 h-1.5) colored dot below favicon using `#2E75B6` accent color
  - Horizontal scroll uses `overflow-x-auto` with custom `scrollbar-none` CSS class to hide scrollbar
  - Favicon fallback shows first letter of app title in a circle when no favicon URL
  - The component returns null when there are no pinned apps (clean empty state)
---

## Iteration 9 - Sun Feb 15 16:09:22 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260215-154616/iter-9.log
---
**US-009 is complete.** Here's what was implemented:

- **`src/sidepanel/PinnedAppsRow.tsx`** — New component that:
  - Displays pinned apps as a horizontal row of 32x32 favicon circles (Zone 2, below search bar)
  - Scrolls horizontally when more than ~8 items, with hidden scrollbar
  - Shows a 6px `#2E75B6` active indicator dot below apps that have a matching open tab (origin matching)
  - Listens to `chrome.storage.onChanged` for real-time updates when pinned apps change
  - Falls back to showing first letter of title when no favicon is available

- **`src/shared/types.ts`** — Added `OPEN_PINNED_APP` message type with `url` and `origin` fields

- **`src/background/service-worker.ts`** — Added handler that finds an existing tab with matching origin (switches to it) or opens a new tab

- **`src/sidepanel/App.tsx`** — Integrated `PinnedAppsRow` between search bar and tab list

- All quality checks pass (typecheck, lint, build). Committed as `45f7fd3`.

There are still stories with `passes: false` (US-010 through US-041), so the next iteration will pick up US-010.
---

## 2026-02-15 - US-010
- Implemented pinned apps add/remove via sidebar context menu
- Files created:
  - src/sidepanel/ContextMenu.tsx (reusable context menu component with click-outside and Escape to close)
- Files changed:
  - src/sidepanel/App.tsx (added tab right-click with Pin/Unpin, lifted context menu state, pinned apps tracking)
  - src/sidepanel/PinnedAppsRow.tsx (added right-click on pinned app icons with Rename, Remove, Open in New Tab, Edit URL; inline editing support)
  - src/shared/types.ts (added OPEN_PINNED_APP_NEW_TAB message type)
  - src/background/service-worker.ts (added OPEN_PINNED_APP_NEW_TAB handler)
  - scripts/ralph/prd.json (marked US-010 passes: true)
- **Learnings for future iterations:**
  - Context menus are rendered at App level with state `{ x, y, items }` — child components call `onContextMenu(state)` to show them
  - ContextMenu component handles click-outside dismissal and Escape key; viewport overflow is auto-corrected
  - Inline editing for pinned app rename/URL edit uses a controlled input with blur-to-save and Escape-to-cancel
  - Pin/unpin detection uses origin matching (`getOrigin(tab.url) === getOrigin(app.url)`) for consistency with US-009
  - `OPEN_PINNED_APP_NEW_TAB` is a separate message type from `OPEN_PINNED_APP` — always opens a new tab without origin matching
---

## Iteration 10 - Sun Feb 15 16:12:27 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260215-154616/iter-10.log
---
**US-010 is complete.** Here's what was implemented:

- **`src/sidepanel/ContextMenu.tsx`** — New reusable context menu component with click-outside dismissal, Escape key handling, and viewport overflow correction

- **Tab right-click context menu** — Right-clicking a tab shows "Pin to ArcFlow" (or "Unpin from ArcFlow" if already pinned based on origin matching)

- **Pinned app right-click context menu** — Right-clicking a pinned app icon shows: Rename, Edit URL, Open in New Tab, Remove

- **Inline editing** — Rename and Edit URL trigger an inline text input above the pinned apps row with blur-to-save and Escape-to-cancel

- **`OPEN_PINNED_APP_NEW_TAB`** message type added to always open a new tab (unlike `OPEN_PINNED_APP` which does origin matching first)

All quality checks pass (typecheck, lint, build). Committed as `b75e3b6`.

There are still stories with `passes: false` (US-011 through US-041), so the next iteration will pick up US-011.
---

## 2026-02-15 - US-011
- Implemented pinned apps drag-and-drop reorder
- Files changed:
  - package.json (added @dnd-kit/core, @dnd-kit/sortable, @dnd-kit/utilities)
  - src/sidepanel/PinnedAppsRow.tsx (wrapped pinned apps in DndContext + SortableContext, extracted SortablePinnedApp component)
- **Learnings for future iterations:**
  - `@dnd-kit/core` PointerSensor with `activationConstraint: { distance: 5 }` prevents accidental drags when user just wants to click
  - `useSortable` hook provides `setNodeRef`, `attributes`, `listeners`, `transform`, `transition` for each draggable item
  - `CSS.Transform.toString(transform)` from `@dnd-kit/utilities` converts transform to CSS string
  - `arrayMove` from `@dnd-kit/sortable` reorders arrays and is used for optimistic UI update before persisting
  - `touch-none` Tailwind class needed on draggable items to prevent browser touch scroll interference
  - `draggable={false}` on `<img>` elements inside draggable items prevents browser native image drag behavior
  - `horizontalListSortingStrategy` from `@dnd-kit/sortable` is ideal for horizontal reorder rows
---

## Iteration 11 - Sun Feb 15 16:14:45 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260215-154616/iter-11.log
---
**US-011 is complete.** Here's what was implemented:

- **`@dnd-kit/core`**, **`@dnd-kit/sortable`**, and **`@dnd-kit/utilities`** installed as dependencies
- **`SortablePinnedApp`** — New component wrapping each pinned app icon with `useSortable` hook for drag-and-drop
- **`DndContext` + `SortableContext`** — Wraps the pinned apps row with `horizontalListSortingStrategy` and `closestCenter` collision detection
- **`PointerSensor`** with `distance: 5` activation constraint prevents accidental drags from click interactions
- **Optimistic reorder** — `arrayMove` updates local state immediately, then `reorderPinnedApps()` persists to `chrome.storage.local`
- **Visual feedback** — Dragged item has `opacity: 0.5`, items have `touch-none` class, images have `draggable={false}`

All quality checks pass (typecheck, lint, build). Committed as `2d72ba2`.

There are still stories with `passes: false` (US-012 through US-041), so the next iteration will pick up US-012.
---

## 2026-02-15 - US-012
- Implemented Chrome page-level context menu for Pin/Unpin to ArcFlow
- Files changed:
  - src/background/service-worker.ts (added contextMenus.create, onClicked handler, dynamic title update)
- **Learnings for future iterations:**
  - `chrome.contextMenus.create()` must be called inside `chrome.runtime.onInstalled` listener, not at top level
  - `chrome.contextMenus.update()` can change the title dynamically — used to toggle between "Pin to ArcFlow" and "Unpin from ArcFlow"
  - Context menu title updates on `tabs.onActivated` and `tabs.onUpdated` (when URL changes on active tab)
  - `info.pageUrl` is a fallback when `tab.url` is undefined in the `onClicked` handler
  - Service worker imports from `../shared/storage` work because Vite bundles the service worker entry
  - The `contextMenus` permission was already in manifest.json from US-001 scaffolding
---

## Iteration 12 - Sun Feb 15 16:16:31 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260215-154616/iter-12.log
---
**US-012 is complete.** Here's what was implemented:

- **Chrome page-level context menu** — `chrome.contextMenus.create()` registers "Pin to ArcFlow" with `contexts: ['page']` in the `onInstalled` listener
- **Pin/Unpin toggle** — Clicking the menu item checks if the current tab's URL origin is already pinned:
  - If pinned → removes the pinned app via `removePinnedApp()`
  - If not pinned → adds it via `addPinnedApp()` with tab's URL, title, and favicon
- **Dynamic menu title** — Menu updates to "Unpin from ArcFlow" when navigating to an already-pinned site, via `chrome.contextMenus.update()` on tab activation and URL changes
- **Storage integration** — Imports from `src/shared/storage.ts` for `getPinnedApps`, `addPinnedApp`, `removePinnedApp`

All quality checks pass (typecheck, lint, build). Committed as `b53af8b`.

There are still stories with `passes: false` (US-013 through US-041), so the next iteration will pick up US-013.
---

## 2026-02-15 - US-013
- Implemented folder storage helpers and data model
- Files created:
  - src/shared/folderStorage.ts (getFolders, createFolder, renameFolder, deleteFolder, moveItemToFolder, updateFolder, addItemToFolder, removeItemFromFolder)
- **Learnings for future iterations:**
  - Folder storage uses key `folders` in `chrome.storage.local`
  - `createFolder(name, parentId?)` validates nesting depth via parentId chain traversal; rejects if depth >= 3
  - `deleteFolder(id)` cascades: collects all descendant folder IDs recursively before deleting
  - `moveItemToFolder(itemId, targetFolderId)` searches across all folders' items arrays to find the source
  - Additional helpers `updateFolder`, `addItemToFolder`, `removeItemFromFolder` added for future UI stories
  - Follows same pattern as `src/shared/storage.ts` (pinned apps): get/save with typed casts, sort by sortOrder
  - `crypto.randomUUID()` used for ID generation (available in Chrome extension context)
---

## Iteration 13 - Sun Feb 15 16:18:18 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260215-154616/iter-13.log
---
**US-013 is complete.** Here's what was implemented:

- **`src/shared/folderStorage.ts`** — New module with 8 exported functions:
  - `getFolders()` — Retrieves all folders sorted by sortOrder
  - `createFolder(name, parentId?)` — Creates a folder with nesting depth validation (rejects at depth >= 3) and non-empty name validation
  - `renameFolder(id, name)` — Renames a folder with non-empty name validation
  - `deleteFolder(id)` — Deletes a folder and all its descendants recursively
  - `moveItemToFolder(itemId, targetFolderId)` — Moves a FolderItem between folders
  - `updateFolder(id, data)` — Partial update for folder properties (e.g., isCollapsed, sortOrder)
  - `addItemToFolder(folderId, item)` — Adds a FolderItem to a folder
  - `removeItemFromFolder(folderId, itemId)` — Removes a FolderItem from a folder

- All acceptance criteria met: storage helpers, data shapes match types.ts, nesting depth validated, non-empty names enforced, typecheck/lint/build pass
- Committed as `7e4bc5d`

There are still stories with `passes: false` (US-014 through US-041), so the next iteration will pick up US-014.
---

## 2026-02-15 - US-014
- Implemented folder tree UI with create, rename, delete, and collapse functionality
- Files created:
  - src/sidepanel/FolderTree.tsx (FolderTree and FolderHeader components)
- Files changed:
  - src/sidepanel/App.tsx (imported and placed FolderTree component in Zone 3, between Pinned Apps and tab list)
  - scripts/ralph/prd.json (marked US-014 passes: true)
- **Learnings for future iterations:**
  - FolderTree component listens to `chrome.storage.onChanged` for key `folders` — same pattern as PinnedAppsRow
  - Collapse toggle updates local state optimistically then persists via `updateFolder(id, { isCollapsed: ... })`
  - Folder rendering is recursive: `renderFolder(folder, depth)` indents children at 16px per depth level
  - Double-click folder name enters inline edit mode; blur or Enter commits, Escape cancels
  - Context menu "Rename" via right-click falls back to `window.prompt` since triggering inline edit from context menu callback is complex; double-click provides the inline editing experience
  - Folder header shows count badge like `(2 tabs, 1 link)` computed from folder.items
  - Delete confirmation only shows when folder has tabs (type==='tab'); empty folders delete silently
  - FolderTree renders "New Folder" button when no folders exist; shows "Folders" section header with + button when folders exist
---

## Iteration 14 - Sun Feb 15 16:21:31 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260215-154616/iter-14.log
---
**US-014 is complete.** Here's what was implemented:

- **`src/sidepanel/FolderTree.tsx`** — New component with:
  - **FolderHeader** sub-component with chevron toggle, folder icon, inline editable name, and count badge
  - **"New Folder" button** that creates a folder named "New Folder" via `createFolder()`
  - **Double-click rename** — double-clicking folder name enters inline edit mode with blur/Enter to commit, Escape to cancel
  - **Right-click context menu** — Rename and Delete options via the shared `ContextMenu` system
  - **Delete confirmation** — prompts `"Close X tabs and delete folder?"` when folder contains tabs
  - **Collapsible folders** — chevron toggle with collapse state persisted to `chrome.storage.local` via `updateFolder()`
  - **Count badge** — displays `(X tabs, Y links)` next to folder name
  - **Recursive tree rendering** — supports nested folders with 16px indentation per level

- **`src/sidepanel/App.tsx`** — Integrated FolderTree in Zone 3, between Pinned Apps Row and tab list

- All quality checks pass (typecheck, lint, build). Committed as `65a0c30`.

There are still stories with `passes: false` (US-015 through US-041), so the next iteration will pick up US-015.
---

## 2026-02-15 - US-015
- Implemented nested folders up to 3 levels deep
- Files changed:
  - src/sidepanel/FolderTree.tsx (added "New Subfolder" context menu option, error toast for depth limit, updated handleCreateFolder to accept parentId)
  - scripts/ralph/prd.json (marked US-015 passes: true)
- **Learnings for future iterations:**
  - "New Subfolder" added to folder right-click context menu — calls `createFolder(name, parentId)` which validates depth via parentId chain in `folderStorage.ts`
  - Error toast displayed inline below folder tree when nesting depth >= 3; auto-dismisses after 3 seconds
  - 16px indentation per level and parent collapse hiding nested children were already implemented in US-014's recursive `renderFolder(folder, depth)`
  - `handleCreateFolder` changed from no-args to optional `parentId` arg to support both top-level and subfolder creation
---

## Iteration 15 - Sun Feb 15 16:23:36 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260215-154616/iter-15.log
---
**US-015 is complete.** Here's what was implemented:

- **"New Subfolder" context menu option** — Right-clicking a folder now shows "New Subfolder" which creates a child folder via `createFolder(name, parentId)`
- **Error toast for depth limit** — When attempting to nest beyond 3 levels, an inline error toast appears below the folder tree and auto-dismisses after 3 seconds
- **16px indentation per level** — Already implemented in US-014's recursive `renderFolder`
- **Collapsing parent hides nested children** — Already works via the recursive render structure from US-014

All quality checks pass (typecheck, lint, build). Committed as `24a527b`.

There are still stories with `passes: false` (US-016 through US-041), so the next iteration will pick up US-016.
---

## 2026-02-15 - US-016
- Implemented drag-and-drop tabs into folders with full reorder support
- Files changed:
  - src/sidepanel/App.tsx (added DndContext wrapping folder tree + tab list, DraggableTabItem component, DragOverlay, custom collision detection, drag end handler for 4 cases: tab→folder, item→folder, item reorder, folder reorder)
  - src/sidepanel/FolderTree.tsx (refactored to receive folders/setFolders as props, added SortableFolder with useDroppable for drop targets, DraggableFolderItem with useSortable, SortableContext for folder items and top-level folders)
  - src/shared/folderStorage.ts (added reorderFolders and reorderItemsInFolder helpers)
  - scripts/ralph/prd.json (marked US-016 passes: true)
- **Learnings for future iterations:**
  - When DnD spans multiple components (tabs → folders), use a single `DndContext` at the common ancestor (App) wrapping all draggable/droppable areas
  - ID prefixes (`tab:`, `folder:`, `folder-item:`, `folder-drop:`) disambiguate drag source/target types in `onDragEnd`
  - `useDroppable` on folder nodes creates drop targets; `useSortable` on folder items enables reorder; both can coexist on same node via combined ref callback
  - Custom collision detection using `pointerWithin` (prioritizing `folder-drop:` targets) + `rectIntersection` fallback gives good behavior for both folder drops and sortable reorder
  - Folder state was lifted from FolderTree to App level to enable cross-component DnD; storage listener for `folders` key moved to App
  - `DragOverlay` renders a styled clone of the dragged tab for better visual feedback during drag
  - `touch-none` class on draggable items prevents browser touch scroll interference
  - `draggable={false}` on `<img>` elements inside draggable items prevents native browser image drag
---

## Iteration 16 - Sun Feb 15 16:28:57 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260215-154616/iter-16.log
---
**US-016 is complete.** Here's what was implemented:

- **Draggable tabs** — Tab items in the sidebar are now draggable using `useDraggable` from `@dnd-kit/core`, with a `DragOverlay` showing a styled clone during drag
- **Folder drop targets** — Each folder is wrapped with `useDroppable`, highlighting with a blue ring and background when a tab is dragged over it
- **Tab → folder drop** — Dropping a tab onto a folder creates a new `FolderItem` (type: 'tab') and adds it to the folder via `addItemToFolder()`
- **Item reorder within folders** — Folder items use `useSortable` for drag-and-drop reordering, persisted via `reorderItemsInFolder()`
- **Folder reorder** — Folders use `useSortable` for drag-and-drop reordering among siblings, persisted via `reorderFolders()`
- **Cross-folder item moves** — Dragging a folder item onto a different folder moves it via `moveItemToFolder()`
- **Custom collision detection** — Uses `pointerWithin` prioritizing folder drop targets, with `rectIntersection` fallback for sortable items
- **State lifted** — Folder state moved from FolderTree to App level to enable cross-component DnD

New storage helpers added: `reorderFolders()` and `reorderItemsInFolder()` in `src/shared/folderStorage.ts`.

All quality checks pass (typecheck, lint, build). Committed as `03d4e5d`.

There are still stories with `passes: false` (US-017 through US-041), so the next iteration will pick up US-017.
---

## 2026-02-15 - US-017
- Implemented saved links in folders
- Files changed:
  - src/shared/types.ts (added OPEN_URL to SidePanelMessage union)
  - src/background/service-worker.ts (added OPEN_URL handler to open URLs as new tabs)
  - src/sidepanel/App.tsx (added "Save Link to Folder..." tab context menu option, FolderPickerDropdown component, folder item click/context menu handlers)
  - src/sidepanel/FolderTree.tsx (added onItemClick and onItemContextMenu props to DraggableFolderItem, SortableFolder, and FolderTree)
  - scripts/ralph/prd.json (marked US-017 passes: true)
- **Learnings for future iterations:**
  - Saved links are FolderItem with `type: 'link'` and `tabId: null`
  - Saved links already had dimmed styling in DraggableFolderItem from US-016 (`text-gray-400 dark:text-gray-500 italic` when type === "link")
  - FolderPickerDropdown renders as a fixed-position overlay with click-outside and Escape dismissal
  - Folder item interactions (click, context menu) are passed from App → FolderTree → SortableFolder → DraggableFolderItem as callback props
  - `OPEN_URL` message type opens a new tab via `chrome.tabs.create({ url })` — distinct from `OPEN_PINNED_APP` which does origin matching
---

## Iteration 17 - Sun Feb 15 16:33:21 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260215-154616/iter-17.log
---
**US-017 is complete.** Here's what was implemented:

- **"Save Link to Folder..."** context menu option on tab right-click, which opens a `FolderPickerDropdown` showing all folders (with nested indentation) to choose a destination
- **Saved links** stored as `FolderItem` with `type: 'link'` and `tabId: null`
- **Dimmed style** for saved links already existed from US-016 (gray text + italic in `DraggableFolderItem`)
- **Click to open**: Clicking a saved link sends `OPEN_URL` message to service worker, which opens it as a new tab via `chrome.tabs.create`
- **Right-click to remove**: Right-clicking a saved link shows "Open Link" and "Remove" options
- **Persistence**: Saved links persist in `chrome.storage.local` as part of folder items
- **`OPEN_URL`** message type added to `SidePanelMessage` and handled in service worker

All quality checks pass (typecheck, lint, build). Committed as `e132c2b`.

There are still stories with `passes: false` (US-018 through US-041), so the next iteration will pick up US-018.
---

## 2026-02-15 - US-018
- Implemented tab search with fuzzy matching using fuse.js
- Files created:
  - src/sidepanel/SearchBar.tsx (search bar component with fuzzy search, keyboard navigation, results dropdown)
- Files changed:
  - src/sidepanel/App.tsx (replaced placeholder search bar with SearchBar component, imported SearchBar)
  - package.json (added fuse.js dependency)
  - scripts/ralph/prd.json (marked US-018 passes: true)
- **Learnings for future iterations:**
  - `fuse.js` provides fuzzy matching out of the box; configure `keys` with weights and `threshold` for sensitivity
  - Custom ranking applied on top of fuse results: exact match (score 0) > starts-with (0.1) > URL contains (0.3) > fuzzy (fuse score)
  - 150ms debounce implemented via setTimeout in useEffect; selectedIndex reset happens inside the same setTimeout callback to avoid `react-hooks/set-state-in-effect` lint error
  - Search results dropdown uses `onMouseDown` with `e.preventDefault()` instead of `onClick` to prevent input blur before the click registers
  - Input `onBlur` has a 150ms delay via setTimeout to allow result click to register before dropdown hides
  - Arrow keys navigate results, Enter activates selected result, Escape clears search and blurs input
  - Results capped at 20 items; scroll into view for keyboard navigation
---

## Iteration 18 - Sun Feb 15 16:36:37 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260215-154616/iter-18.log
---
**US-018 is complete.** Here's what was implemented:

- **`src/sidepanel/SearchBar.tsx`** — New component that:
  - Replaces the placeholder search bar with a functional input at the top of the sidebar (Zone 1, ~40px)
  - Uses **fuse.js** for fuzzy matching across tab titles, URLs, folder names, and saved link titles
  - **Custom ranking**: exact > starts-with > fuzzy > URL match
  - **150ms debounce** on search input
  - **Keyboard navigation**: Arrow keys to navigate results, Enter to activate (switches to tab or opens saved link), Escape to clear and restore full tree view
  - Results dropdown shows up to 20 items with type badges (Tab/Link/Folder), favicons, and URLs
  - Clear button (X) to reset search

- **`src/sidepanel/App.tsx`** — Replaced placeholder search div with `SearchBar` component, passing tabs, folders, and callback handlers

- **`package.json`** — Added `fuse.js` dependency

All quality checks pass (typecheck, lint, build). Committed as `7024a07`.

There are still stories with `passes: false` (US-019 through US-041), so the next iteration will pick up US-019.
---

## 2026-02-15 - US-019
- Implemented visual indicators for active, audio, and discarded tabs
- Files changed:
  - src/sidepanel/App.tsx (added speaker icon for audible tabs, dimmed opacity + italic for discarded tabs)
- **Learnings for future iterations:**
  - `TabInfo` already had `audible` and `discarded` fields from US-003; `mapTab` in service-worker.ts already maps `tab.audible` and `tab.discarded`
  - Audio indicator uses Lucide Volume2 SVG icon (inline) with `text-blue-500` color, placed between title and close button
  - Discarded tab styling uses `opacity-50 italic` Tailwind classes on the entire `<li>` element
  - Active tab styling (3px #2E75B6 left border + bold) was already implemented in US-005
  - Real-time updates already work because `tabs.onUpdated` triggers `debouncedRefresh()` which broadcasts full tab list with audible/discarded props
  - This was a minimal change — only the DraggableTabItem component needed updates
---

## Iteration 19 - Sun Feb 15 16:38:26 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260215-154616/iter-19.log
---
**US-019 is complete.** Here's what was implemented:

- **Audio indicator**: Tabs playing audio show a Lucide Volume2 speaker icon (blue) next to the title, using the `tab.audible` property
- **Discarded/suspended tab styling**: Discarded tabs display with `opacity-50` and `italic` text, using the `tab.discarded` property
- **Active tab**: Already had 3px `#2E75B6` left border + bold text from US-005 — verified consistency
- **Real-time updates**: Already work via `tabs.onUpdated` → `debouncedRefresh()` → `TABS_UPDATED` broadcast with `audible`/`discarded` fields

All quality checks pass (typecheck, lint, build). Committed as `3518159`.

There are still stories with `passes: false` (US-020 through US-041), so the next iteration will pick up US-020.
---

## 2026-02-15 - US-020
- Implemented folder-level actions: Open All Tabs, Close All Tabs, Collapse All Subfolders
- Files changed:
  - src/shared/types.ts (added CLOSE_TABS batch message type to SidePanelMessage)
  - src/background/service-worker.ts (added CLOSE_TABS handler using chrome.tabs.remove with array)
  - src/sidepanel/FolderTree.tsx (added Open All Tabs, Close All Tabs, Collapse All Subfolders to folder context menu; added handleCollapseAll; added onOpenAllTabs/onCloseAllTabs props)
  - src/sidepanel/App.tsx (added handleOpenAllTabs and handleCloseAllTabs handlers, passed to FolderTree)
  - scripts/ralph/prd.json (marked US-020 passes: true)
- **Learnings for future iterations:**
  - "Open All Tabs" opens saved links (type === 'link') as new tabs; "Close All Tabs" closes active tabs (type === 'tab') — saved links remain untouched
  - `CLOSE_TABS` message type accepts `tabIds: number[]` for batch closing via `chrome.tabs.remove(tabIds)` which accepts an array natively
  - "Collapse All Subfolders" recursively collects descendant folder IDs and sets `isCollapsed: true` on all of them with optimistic UI update
  - Folder-level action callbacks (onOpenAllTabs, onCloseAllTabs) are passed from App to FolderTree as props since they need chrome.runtime.sendMessage access
---

## Iteration 20 - Sun Feb 15 16:41:25 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260215-154616/iter-20.log
---
**US-020 is complete.** Here's what was implemented:

- **"Open All Tabs"** — Opens all saved links (type === 'link') in the folder as new tabs via `OPEN_URL` messages
- **"Close All Tabs"** — Closes all active tabs (type === 'tab') in the folder via new `CLOSE_TABS` batch message; saved links remain untouched
- **"Collapse All Subfolders"** — Collapses the folder and all nested subfolders recursively, with optimistic UI update and persistence to `chrome.storage.local`
- Added `CLOSE_TABS` message type to `SidePanelMessage` for batch tab closing via `chrome.tabs.remove(tabIds[])`
- All three actions added to folder right-click context menu alongside existing options (New Subfolder, Rename, Delete)

All quality checks pass (typecheck, lint, build). Committed as `3176696`.

There are still stories with `passes: false` (US-021 through US-041), so the next iteration will pick up US-021.
---

## 2026-02-15 - US-021
- Implemented workspace storage model and helpers
- Files created:
  - src/shared/workspaceStorage.ts (getWorkspaces, createWorkspace, updateWorkspace, deleteWorkspace, getActiveWorkspace, setActiveWorkspace, getTabWorkspaceMap, assignTabToWorkspace, removeTabFromMap, getWorkspacePinnedApps, getWorkspaceFolders)
- Files changed:
  - scripts/ralph/prd.json (marked US-021 passes: true)
- **Learnings for future iterations:**
  - Workspace storage uses `ensureInitialized()` pattern — checks if `workspaces` key exists on first access and creates Default workspace if missing
  - Default workspace has fixed id `"default"` and cannot be deleted or renamed (enforced in updateWorkspace/deleteWorkspace)
  - Tab-to-workspace mapping stored as `Record<string, string>` with tabId as string key (since object keys are always strings)
  - `saveWorkspaces()` wraps `chrome.storage.local.set` with quota error handling (catches `QUOTA_BYTES_PER_ITEM`)
  - `deleteWorkspace()` also cleans up tab-workspace mappings and switches active workspace to Default if deleted workspace was active
  - Schema version (key: `schemaVersion`, initial: 1) stored for future migration support
  - Each workspace stores independent `pinnedApps[]` and `folders[]` — helpers `getWorkspacePinnedApps` and `getWorkspaceFolders` provide typed access
---
