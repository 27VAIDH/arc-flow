# Ralph Progress Log
Feature: ArcFlow v1.1 — Delight & Stickiness (Swipe, Panel Color, DnD, Rename)
Branch: ralph/v1.1-delight-stickiness
---

## Codebase Patterns
- Accent color applied via CSS variables (--color-arc-accent) set in useTheme.ts applyAccentColor()
- COLOR_PALETTE array (12 colors) shared between SettingsPanel.tsx and WorkspaceSwitcher.tsx
- lightenColor() in useTheme.ts lightens a hex color by 20% for hover variants
- Workspace data stored via chrome.storage.local with schema versioning in workspaceStorage.ts
- Inline rename pattern: editing state + editName + inputRef + committedRef guard (see FolderHeader in FolderTree.tsx)
- DnD uses @dnd-kit/core + @dnd-kit/sortable with custom collision detection in App.tsx
- DnD ID prefixes: tab:, folder-item:, folder:, folder-drop: — pinned apps use raw UUIDs
- Tab list uses react-window (FixedSizeList) for >50 tabs with TAB_ITEM_HEIGHT = 36px
- Storage changes propagated via chrome.storage.onChanged listeners
- All workspace data (pinnedApps, folders, notes) lives inside the Workspace object in workspaceStorage.ts
- Inline rename inputs MUST call e.stopPropagation() in onKeyDown to prevent parent DnD/keyboard handlers from intercepting Enter/Escape
- When adding inline edit to a clickable item, guard the onClick handler with `if (!editing)` to prevent navigation during edit
- Per-workspace auxiliary data (e.g., tabNameOverrides) stored as separate chrome.storage.local keys with `_<workspaceId>` suffix
- Panel background color applied via CSS variables (--color-arc-panel-bg, --color-arc-panel-bg-secondary) set in useTheme.ts applyPanelColor()
- applyPanelColor() is exported from useTheme.ts for direct use by SettingsPanel
- VirtualTabRow passes props via rowProps — any new DraggableTabItem props must also be added to VirtualTabRowProps and VirtualTabRow
- Panel color application is owned by App.tsx (not useTheme) to support per-workspace overrides — useTheme exports applyPanelColor() but doesn't call it
- Per-workspace panelColor overrides global settings.panelColor; empty/undefined workspace panelColor falls back to global
---

## 2026-02-17 - US-001
- Fixed folder double-click rename Enter key bug
- Added e.stopPropagation() to FolderHeader rename input's onKeyDown handler
- Files changed: src/sidepanel/FolderTree.tsx (line 123)
- **Learnings for future iterations:**
  - The SortableFolder component (parent of FolderHeader) has an onKeyDown handler on its wrapper div that intercepts Enter to toggle collapse — any inline input inside it MUST stopPropagation
  - Same pattern will apply to US-002 (folder item rename) — the DraggableFolderItem also has an onKeyDown handler that intercepts Enter
  - The committedRef guard + editing state + inputRef + editName pattern is the standard inline rename pattern in this codebase
---

## Iteration 1 - Tue Feb 17 18:07:26 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260217-180605/iter-1.log
---
US-001 is complete. There are still 14 stories with `passes: false` remaining (US-002 through US-015).

**Summary of US-001 completion:**
- **Bug**: The Enter key in the folder rename input was being intercepted by the parent `SortableFolder`'s `onKeyDown` handler (which toggles folder collapse on Enter), preventing `commitRename()` from firing.
- **Fix**: Added `e.stopPropagation()` as the first line of the rename input's `onKeyDown` handler in `FolderHeader` (FolderTree.tsx:123).
- **Commit**: `c3baee4` — `feat: US-001 - Fix folder double-click rename Enter key bug`
- **Typecheck & lint**: Pass cleanly.
---

## 2026-02-17 - US-002
- Added inline double-click rename to folder items in FolderTree.tsx
- Added editing/editName/inputRef/committedRef state to DraggableFolderItem component
- Double-click on item title enters edit mode; Enter/blur saves; Escape cancels
- onKeyDown calls e.stopPropagation() to prevent parent DnD handlers from intercepting
- e.preventDefault() + e.stopPropagation() on double-click prevents navigation
- Empty names rejected and revert to original
- Optimistic UI update via setFolders in App.tsx, then persists via renameItemInFolder()
- Files changed: src/sidepanel/FolderTree.tsx, src/sidepanel/App.tsx
- **Learnings for future iterations:**
  - The onItemRename prop flows: App.tsx -> FolderTree -> SortableFolder -> DraggableFolderItem
  - When adding inline edit to a clickable item, guard the onClick with `if (!editing)` to prevent clicks during edit
  - The pre-existing eslint error in App.tsx (set-state-in-effect at line 530) is not from our changes
---

## Iteration 2 - Tue Feb 17 18:11:17 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260217-180605/iter-2.log
---
US-002 is complete. There are still 13 stories with `passes: false` remaining (US-003 through US-015).

**Summary of US-002 completion:**
- **Feature**: Added inline double-click rename to folder items in `DraggableFolderItem` component
- **Pattern**: Reused the same `editing`/`editName`/`inputRef`/`committedRef` pattern from `FolderHeader`
- **Key details**:
  - `e.stopPropagation()` in `onKeyDown` prevents parent DnD handlers from intercepting Enter/Escape
  - `e.preventDefault()` + `e.stopPropagation()` on double-click prevents navigation
  - onClick guarded with `if (!editing)` to prevent clicks during edit mode
  - Optimistic UI update in App.tsx via `setFolders`, then persisted via `renameItemInFolder()`
- **Files changed**: `src/sidepanel/FolderTree.tsx`, `src/sidepanel/App.tsx`
- **Commit**: `38fdfa9` — `feat: US-002 - Add double-click rename to folder items in FolderTree`
- **Typecheck**: Passes cleanly
---

## 2026-02-17 - US-003
- Added double-click rename to pinned apps in PinnedAppsRow.tsx
- Reused existing editingApp state and handleEditSubmit/handleEditKeyDown from right-click rename
- Added onDoubleClick prop to SortablePinnedApp component
- handleDoubleClick calls e.preventDefault() + e.stopPropagation() to prevent app URL opening
- Added e.stopPropagation() to handleEditKeyDown to prevent parent handler interception
- Files changed: src/sidepanel/PinnedAppsRow.tsx
- **Learnings for future iterations:**
  - PinnedAppsRow already had full inline edit infrastructure (editingApp state, editInputRef, handleEditSubmit, handleEditKeyDown) — only needed to wire up onDoubleClick
  - The edit input renders above the icon grid (not inline in the icon) — this is a different pattern from FolderTree inline rename
  - Pre-existing eslint warning about editingApp deps in useEffect (line 150) is not from our changes
---

## Iteration 3 - Tue Feb 17 18:13:13 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260217-180605/iter-3.log
---
US-003 is complete. There are still 12 stories with `passes: false` remaining (US-004 through US-015).

**Summary of US-003 completion:**
- **Feature**: Added double-click rename to pinned app icons in `PinnedAppsRow.tsx`
- **Approach**: Reused the existing `editingApp` state, `handleEditSubmit`, and `handleEditKeyDown` that were already wired for right-click rename
- **Key changes**:
  - Added `onDoubleClick` prop to `SortablePinnedApp` component
  - `handleDoubleClick` calls `e.preventDefault()` + `e.stopPropagation()` to prevent the app URL from opening
  - Added `e.stopPropagation()` to `handleEditKeyDown` to prevent parent handlers from intercepting Enter/Escape
- **Files changed**: `src/sidepanel/PinnedAppsRow.tsx`
- **Commit**: `be585de` — `feat: US-003 - Add double-click rename to pinned apps`
- **Typecheck & lint**: Pass cleanly
---

## 2026-02-17 - US-004
- Added double-click rename to open tabs in the sidebar via DraggableTabItem
- Added tabNameOverrides state (Record<number, string>) to App.tsx, stored per-workspace in chrome.storage.local as `tabNameOverrides_<workspaceId>`
- DraggableTabItem now accepts displayName and onTabRename props
- Double-click enters inline edit mode; Enter/blur saves; Escape cancels
- onKeyDown calls e.stopPropagation() to prevent parent handler interception
- e.preventDefault() + e.stopPropagation() on double-click prevents tab switching
- onClick guarded with `if (editing) return` to prevent clicks during edit mode
- committedRef guard prevents double-commit on simultaneous blur + Enter
- Tabs with custom names display in italic with original title in tooltip
- Empty name input clears the override and reverts to original title
- Also updated VirtualTabRow to pass through displayName and onTabRename for virtual list rendering
- Files changed: src/sidepanel/App.tsx
- **Learnings for future iterations:**
  - tabNameOverrides stored as separate chrome.storage.local key per workspace (`tabNameOverrides_<wsId>`) rather than inside the Workspace object — keeps workspace storage lean
  - VirtualTabRow component passes props via rowProps — any new DraggableTabItem props must also be added to VirtualTabRowProps interface and the VirtualTabRow function signature
  - The RefObject type import from React is needed when using `useRef<HTMLInputElement>(null) as RefObject<HTMLInputElement>` pattern
---

## Iteration 4 - Tue Feb 17 18:16:52 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260217-180605/iter-4.log
---
US-004 is complete. There are still 11 stories with `passes: false` remaining (US-005 through US-015).

**Summary of US-004 completion:**
- **Feature**: Added double-click rename to open tabs in the sidebar via `DraggableTabItem`
- **Storage**: `tabNameOverrides` stored per-workspace in `chrome.storage.local` as `tabNameOverrides_<workspaceId>` (Record<number, string>)
- **Key changes**:
  - `DraggableTabItem` now accepts `displayName` and `onTabRename` props
  - Double-click enters inline edit mode with `e.preventDefault()` + `e.stopPropagation()` to prevent tab switching
  - `onKeyDown` calls `e.stopPropagation()` to prevent parent DnD handlers from intercepting Enter/Escape
  - onClick guarded with `if (editing) return`
  - Tabs with custom names display in italic with original title in tooltip
  - Empty name input clears the override
  - Updated `VirtualTabRow` and `VirtualTabRowProps` to pass through the new props
- **Files changed**: `src/sidepanel/App.tsx`
- **Commit**: `e80eb47` — `feat: US-004 - Add double-click rename to open tabs in sidebar`
- **Typecheck**: Passes cleanly
---

## 2026-02-17 - US-005
- Added panelColor field to Settings interface (string) and Workspace interface (optional string) in types.ts
- Added panelColor: '' default to DEFAULT_SETTINGS in constants.ts
- No schema migration needed — panelColor is optional on Workspace and getSettings() spreads defaults over stored values
- Files changed: src/shared/types.ts, src/shared/constants.ts
- **Learnings for future iterations:**
  - Settings defaults are in constants.ts (DEFAULT_SETTINGS), not in settingsStorage.ts — getSettings() merges stored values over defaults via spread
  - Adding an optional field to Workspace requires no migration since existing workspaces without the field will just have it as undefined
  - updateSettings() and updateWorkspace() both use Partial spread, so new fields "just work" for persistence
---

## Iteration 5 - Tue Feb 17 18:18:26 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260217-180605/iter-5.log
---
**US-005 is complete.** There are still 10 stories with `passes: false` remaining (US-006 through US-015).

**Summary of US-005 completion:**
- **Feature**: Added `panelColor` data model support for panel background color customization
- **Changes**:
  - `Settings` interface: added `panelColor: string` field
  - `Workspace` interface: added optional `panelColor?: string` field
  - `DEFAULT_SETTINGS`: added `panelColor: ""` (empty string = use default dark theme background)
- **Storage**: No migration needed — `panelColor` is optional on Workspace (undefined for existing workspaces) and `getSettings()` merges defaults via spread
- **Files changed**: `src/shared/types.ts`, `src/shared/constants.ts`
- **Commit**: `136d27f` — `feat: US-005 - Add panelColor to Settings and Workspace types with storage support`
- **Typecheck & lint**: Pass cleanly
---

## 2026-02-17 - US-006
- Added applyPanelColor() function to useTheme.ts that sets --color-arc-panel-bg and --color-arc-panel-bg-secondary CSS variables
- Secondary variant auto-computed as 10% lighter using lightenColorByPercent()
- Added getLuminance() function for relative luminance calculation — adds 'light-panel' class when luminance > 0.5
- Empty color string removes CSS variables (falls back to CSS defaults defined in @theme block)
- useTheme hook calls applyPanelColor on mount with stored settings.panelColor
- useTheme hook listens to chrome.storage.onChanged for settings.panelColor updates
- Added --color-arc-panel-bg and --color-arc-panel-bg-secondary to index.css @theme block with default dark values
- Updated App.tsx main container and SettingsPanel.tsx to use dark:bg-[var(--color-arc-panel-bg)] instead of dark:bg-arc-bg
- Files changed: src/sidepanel/useTheme.ts, src/sidepanel/index.css, src/sidepanel/App.tsx, src/sidepanel/SettingsPanel.tsx
- **Learnings for future iterations:**
  - applyPanelColor is exported (not just internal) so SettingsPanel can call it directly for immediate feedback when user picks a color
  - The dark:bg-[var(--color-arc-panel-bg)] Tailwind arbitrary value syntax works for referencing CSS variables in dark mode
  - Default panel bg values in @theme block match the original arc-bg (#0f0f17) so no visual change until user customizes
  - lightenColorByPercent() is a more flexible version of lightenColor() — takes a percent parameter (0.1 = 10%, 0.2 = 20%)
---

## Iteration 6 - Tue Feb 17 18:21:00 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260217-180605/iter-6.log
---
**US-006 is complete.** There are still 9 stories with `passes: false` remaining (US-007 through US-015).

**Summary of US-006 completion:**
- **Feature**: Added panel color CSS variable system to `useTheme.ts` for sidebar background color customization
- **Key changes**:
  - Added `--color-arc-panel-bg` and `--color-arc-panel-bg-secondary` CSS variables to `index.css` @theme block with default dark values matching existing `arc-bg`
  - Created `applyPanelColor(color)` function (exported) that sets both CSS variables, computes 10% lighter secondary variant, and adds/removes `light-panel` class based on luminance
  - Added `getLuminance()` and `lightenColorByPercent()` helper functions
  - `useTheme` hook now applies panel color on mount and listens for `chrome.storage.onChanged` updates
  - Updated `App.tsx` and `SettingsPanel.tsx` to use `dark:bg-[var(--color-arc-panel-bg)]` instead of hardcoded `dark:bg-arc-bg`
- **Files changed**: `src/sidepanel/useTheme.ts`, `src/sidepanel/index.css`, `src/sidepanel/App.tsx`, `src/sidepanel/SettingsPanel.tsx`
- **Commit**: `e40ff7c` — `feat: US-006 - Apply panel color via CSS variables in useTheme hook`
- **Typecheck**: Passes cleanly
---

## 2026-02-17 - US-007
- Added Panel Color picker section to SettingsPanel.tsx below the Accent Color section
- Extracted COLOR_PALETTE constant to replace inline array (shared between accent and panel color pickers)
- Imported applyPanelColor from useTheme.ts for immediate visual feedback on color selection
- Added 12-color preset grid matching accent color palette plus a "Default" swatch (gradient dark circle)
- Added hex input field with regex validation (/^#[0-9A-Fa-f]{6}$/) that applies color on valid input
- Added "Reset" button that clears panelColor and reverts to default dark theme background
- Selected color shows ring indicator; default swatch shows ring when no custom color is set
- Files changed: src/sidepanel/SettingsPanel.tsx
- **Learnings for future iterations:**
  - The accent color section had an inline array of 12 colors — extracted to COLOR_PALETTE constant for reuse
  - applyPanelColor() must be called alongside handleUpdate() for immediate visual feedback (storage roundtrip has latency)
  - The "Default" swatch uses a linear-gradient background to visually distinguish it from color swatches
---

## Iteration 7 - Tue Feb 17 18:22:46 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260217-180605/iter-7.log
---
**US-007 is complete.** There are still 8 stories with `passes: false` remaining (US-008 through US-015).

**Summary of US-007 completion:**
- **Feature**: Added Panel Color picker UI section to `SettingsPanel.tsx` below the Accent Color section
- **Key changes**:
  - Extracted `COLOR_PALETTE` constant (12 colors) to replace inline array, shared by both accent and panel color pickers
  - Imported `applyPanelColor` from `useTheme.ts` for immediate visual feedback
  - 12-color preset grid with ring indicator on selected color
  - "Default" swatch with gradient dark background to visually distinguish reset option
  - Hex input field with regex validation — applies color only on valid 6-digit hex
  - "Reset" button clears panelColor and reverts to default dark theme
- **Files changed**: `src/sidepanel/SettingsPanel.tsx`
- **Commit**: `2dce84d` — `feat: US-007 - Add panel color picker UI in SettingsPanel`
- **Typecheck & lint**: Pass cleanly
---

## 2026-02-17 - US-008
- Added per-workspace panel color support with smooth CSS transitions
- Added "Panel Color" option to workspace context menu in WorkspaceSwitcher.tsx
- Added panel color picker popover with 12-color palette + Default/Reset swatch
- handlePanelColorSelect saves via updateWorkspace() and applies immediately via applyPanelColor()
- handlePanelColorClear clears workspace panelColor and falls back to global setting
- Added useEffect in App.tsx that applies workspace-level panelColor on workspace switch, falling back to global settings
- Moved panel color ownership from useTheme to App.tsx to support per-workspace overrides
- Added CSS transition (200ms ease) on background-color for .dark class in index.css for smooth workspace switches
- Files changed: src/sidepanel/WorkspaceSwitcher.tsx, src/sidepanel/App.tsx, src/sidepanel/useTheme.ts, src/sidepanel/index.css
- **Learnings for future iterations:**
  - Panel color application is now owned by App.tsx (not useTheme) — useTheme still exports applyPanelColor() but no longer applies it on mount or settings change
  - The workspace-switch effect at [activeWorkspaceId, workspaces] handles both workspace switches AND workspace data updates (since storage changes trigger setWorkspaces)
  - SettingsPanel still calls applyPanelColor() directly for immediate feedback when changing global panel color
  - The Default swatch in panel color picker clears the workspace override and falls back to global setting via getSettings()
---

## Iteration 8 - Tue Feb 17 18:27:17 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260217-180605/iter-8.log
---
**US-008 is complete.** There are still 7 stories with `passes: false` remaining (US-009 through US-015).

**Summary of US-008 completion:**
- **Feature**: Added per-workspace panel color with smooth CSS transitions
- **Key changes**:
  - `WorkspaceSwitcher.tsx`: Added "Panel Color" to workspace context menu with a color picker popover (12-color palette + Default/Reset swatch)
  - `App.tsx`: Added `useEffect` at `[activeWorkspaceId, workspaces]` that applies workspace-level `panelColor` or falls back to global settings
  - `useTheme.ts`: Moved panel color application ownership to App.tsx (removed auto-apply on mount/settings change, kept `applyPanelColor()` export)
  - `index.css`: Added 200ms CSS transition on `background-color` for `.dark` class for smooth workspace switches
- **Files changed**: `src/sidepanel/WorkspaceSwitcher.tsx`, `src/sidepanel/App.tsx`, `src/sidepanel/useTheme.ts`, `src/sidepanel/index.css`
- **Commit**: `25a212a` — `feat: US-008 - Add per-workspace panel color with smooth transitions`
- **Typecheck**: Passes cleanly
---

## 2026-02-17 - US-009
- Fixed pinned apps drag-and-drop with visual feedback
- Added DragOverlay component showing dragged app icon at 32x32 with shadow and border
- Added activeDragId state with handleDragStart/onDragCancel handlers
- Changed source item opacity from 0.5 to 0.3 during drag
- Added fallback 200ms transition for shift animations when useSortable doesn't provide one
- Preserved existing PointerSensor distance: 5 activation constraint
- Files changed: src/sidepanel/PinnedAppsRow.tsx
- **Learnings for future iterations:**
  - DragOverlay in @dnd-kit renders a floating copy of the dragged item — source item should be dimmed (not hidden) for spatial awareness
  - useSortable provides a `transition` prop for sibling shift animations, but a fallback `transform 200ms ease` ensures smooth behavior
  - onDragCancel must also clear activeDragId to avoid stale overlay state
---
