# Ralph Progress Log
Feature: ArcFlow v1.1 — Delight & Stickiness (Swipe, Panel Color, DnD, Rename)
Branch: ralph/v1.1-delight-stickiness
---

## Codebase Patterns
- Accent color applied via CSS variables (--color-arc-accent) set in useTheme.ts applyAccentColor()
- COLOR_PALETTE array (12 colors) shared between SettingsPanel.tsx and WorkspaceSwitcher.tsx
- lightenColor() in useTheme.ts lightens a hex color by 20% for hover variants
- Workspace data stored via chrome.storage.local with schema versioning in workspaceStorage.ts
- Inline rename pattern: editing state + editName + inputRef + committedRef guard (see FolderHeader in FolderTree.tsx)
- DnD uses @dnd-kit/core + @dnd-kit/sortable with custom collision detection in App.tsx
- DnD ID prefixes: tab:, folder-item:, folder:, folder-drop: — pinned apps use raw UUIDs
- Tab list uses react-window (FixedSizeList) for >50 tabs with TAB_ITEM_HEIGHT = 36px
- Storage changes propagated via chrome.storage.onChanged listeners
- All workspace data (pinnedApps, folders, notes) lives inside the Workspace object in workspaceStorage.ts
- Inline rename inputs MUST call e.stopPropagation() in onKeyDown to prevent parent DnD/keyboard handlers from intercepting Enter/Escape
- When adding inline edit to a clickable item, guard the onClick handler with `if (!editing)` to prevent navigation during edit
- Per-workspace auxiliary data (e.g., tabNameOverrides) stored as separate chrome.storage.local keys with `_<workspaceId>` suffix
- Panel background color applied via CSS variables (--color-arc-panel-bg, --color-arc-panel-bg-secondary) set in useTheme.ts applyPanelColor()
- applyPanelColor() is exported from useTheme.ts for direct use by SettingsPanel
- VirtualTabRow passes props via rowProps — any new DraggableTabItem props must also be added to VirtualTabRowProps and VirtualTabRow
---

## 2026-02-17 - US-001
- Fixed folder double-click rename Enter key bug
- Added e.stopPropagation() to FolderHeader rename input's onKeyDown handler
- Files changed: src/sidepanel/FolderTree.tsx (line 123)
- **Learnings for future iterations:**
  - The SortableFolder component (parent of FolderHeader) has an onKeyDown handler on its wrapper div that intercepts Enter to toggle collapse — any inline input inside it MUST stopPropagation
  - Same pattern will apply to US-002 (folder item rename) — the DraggableFolderItem also has an onKeyDown handler that intercepts Enter
  - The committedRef guard + editing state + inputRef + editName pattern is the standard inline rename pattern in this codebase
---

## Iteration 1 - Tue Feb 17 18:07:26 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260217-180605/iter-1.log
---
US-001 is complete. There are still 14 stories with `passes: false` remaining (US-002 through US-015).

**Summary of US-001 completion:**
- **Bug**: The Enter key in the folder rename input was being intercepted by the parent `SortableFolder`'s `onKeyDown` handler (which toggles folder collapse on Enter), preventing `commitRename()` from firing.
- **Fix**: Added `e.stopPropagation()` as the first line of the rename input's `onKeyDown` handler in `FolderHeader` (FolderTree.tsx:123).
- **Commit**: `c3baee4` — `feat: US-001 - Fix folder double-click rename Enter key bug`
- **Typecheck & lint**: Pass cleanly.
---

## 2026-02-17 - US-002
- Added inline double-click rename to folder items in FolderTree.tsx
- Added editing/editName/inputRef/committedRef state to DraggableFolderItem component
- Double-click on item title enters edit mode; Enter/blur saves; Escape cancels
- onKeyDown calls e.stopPropagation() to prevent parent DnD handlers from intercepting
- e.preventDefault() + e.stopPropagation() on double-click prevents navigation
- Empty names rejected and revert to original
- Optimistic UI update via setFolders in App.tsx, then persists via renameItemInFolder()
- Files changed: src/sidepanel/FolderTree.tsx, src/sidepanel/App.tsx
- **Learnings for future iterations:**
  - The onItemRename prop flows: App.tsx -> FolderTree -> SortableFolder -> DraggableFolderItem
  - When adding inline edit to a clickable item, guard the onClick with `if (!editing)` to prevent clicks during edit
  - The pre-existing eslint error in App.tsx (set-state-in-effect at line 530) is not from our changes
---

## Iteration 2 - Tue Feb 17 18:11:17 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260217-180605/iter-2.log
---
US-002 is complete. There are still 13 stories with `passes: false` remaining (US-003 through US-015).

**Summary of US-002 completion:**
- **Feature**: Added inline double-click rename to folder items in `DraggableFolderItem` component
- **Pattern**: Reused the same `editing`/`editName`/`inputRef`/`committedRef` pattern from `FolderHeader`
- **Key details**:
  - `e.stopPropagation()` in `onKeyDown` prevents parent DnD handlers from intercepting Enter/Escape
  - `e.preventDefault()` + `e.stopPropagation()` on double-click prevents navigation
  - onClick guarded with `if (!editing)` to prevent clicks during edit mode
  - Optimistic UI update in App.tsx via `setFolders`, then persisted via `renameItemInFolder()`
- **Files changed**: `src/sidepanel/FolderTree.tsx`, `src/sidepanel/App.tsx`
- **Commit**: `38fdfa9` — `feat: US-002 - Add double-click rename to folder items in FolderTree`
- **Typecheck**: Passes cleanly
---

## 2026-02-17 - US-003
- Added double-click rename to pinned apps in PinnedAppsRow.tsx
- Reused existing editingApp state and handleEditSubmit/handleEditKeyDown from right-click rename
- Added onDoubleClick prop to SortablePinnedApp component
- handleDoubleClick calls e.preventDefault() + e.stopPropagation() to prevent app URL opening
- Added e.stopPropagation() to handleEditKeyDown to prevent parent handler interception
- Files changed: src/sidepanel/PinnedAppsRow.tsx
- **Learnings for future iterations:**
  - PinnedAppsRow already had full inline edit infrastructure (editingApp state, editInputRef, handleEditSubmit, handleEditKeyDown) — only needed to wire up onDoubleClick
  - The edit input renders above the icon grid (not inline in the icon) — this is a different pattern from FolderTree inline rename
  - Pre-existing eslint warning about editingApp deps in useEffect (line 150) is not from our changes
---

## Iteration 3 - Tue Feb 17 18:13:13 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260217-180605/iter-3.log
---
US-003 is complete. There are still 12 stories with `passes: false` remaining (US-004 through US-015).

**Summary of US-003 completion:**
- **Feature**: Added double-click rename to pinned app icons in `PinnedAppsRow.tsx`
- **Approach**: Reused the existing `editingApp` state, `handleEditSubmit`, and `handleEditKeyDown` that were already wired for right-click rename
- **Key changes**:
  - Added `onDoubleClick` prop to `SortablePinnedApp` component
  - `handleDoubleClick` calls `e.preventDefault()` + `e.stopPropagation()` to prevent the app URL from opening
  - Added `e.stopPropagation()` to `handleEditKeyDown` to prevent parent handlers from intercepting Enter/Escape
- **Files changed**: `src/sidepanel/PinnedAppsRow.tsx`
- **Commit**: `be585de` — `feat: US-003 - Add double-click rename to pinned apps`
- **Typecheck & lint**: Pass cleanly
---

## 2026-02-17 - US-004
- Added double-click rename to open tabs in the sidebar via DraggableTabItem
- Added tabNameOverrides state (Record<number, string>) to App.tsx, stored per-workspace in chrome.storage.local as `tabNameOverrides_<workspaceId>`
- DraggableTabItem now accepts displayName and onTabRename props
- Double-click enters inline edit mode; Enter/blur saves; Escape cancels
- onKeyDown calls e.stopPropagation() to prevent parent handler interception
- e.preventDefault() + e.stopPropagation() on double-click prevents tab switching
- onClick guarded with `if (editing) return` to prevent clicks during edit mode
- committedRef guard prevents double-commit on simultaneous blur + Enter
- Tabs with custom names display in italic with original title in tooltip
- Empty name input clears the override and reverts to original title
- Also updated VirtualTabRow to pass through displayName and onTabRename for virtual list rendering
- Files changed: src/sidepanel/App.tsx
- **Learnings for future iterations:**
  - tabNameOverrides stored as separate chrome.storage.local key per workspace (`tabNameOverrides_<wsId>`) rather than inside the Workspace object — keeps workspace storage lean
  - VirtualTabRow component passes props via rowProps — any new DraggableTabItem props must also be added to VirtualTabRowProps interface and the VirtualTabRow function signature
  - The RefObject type import from React is needed when using `useRef<HTMLInputElement>(null) as RefObject<HTMLInputElement>` pattern
---

## Iteration 4 - Tue Feb 17 18:16:52 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260217-180605/iter-4.log
---
US-004 is complete. There are still 11 stories with `passes: false` remaining (US-005 through US-015).

**Summary of US-004 completion:**
- **Feature**: Added double-click rename to open tabs in the sidebar via `DraggableTabItem`
- **Storage**: `tabNameOverrides` stored per-workspace in `chrome.storage.local` as `tabNameOverrides_<workspaceId>` (Record<number, string>)
- **Key changes**:
  - `DraggableTabItem` now accepts `displayName` and `onTabRename` props
  - Double-click enters inline edit mode with `e.preventDefault()` + `e.stopPropagation()` to prevent tab switching
  - `onKeyDown` calls `e.stopPropagation()` to prevent parent DnD handlers from intercepting Enter/Escape
  - onClick guarded with `if (editing) return`
  - Tabs with custom names display in italic with original title in tooltip
  - Empty name input clears the override
  - Updated `VirtualTabRow` and `VirtualTabRowProps` to pass through the new props
- **Files changed**: `src/sidepanel/App.tsx`
- **Commit**: `e80eb47` — `feat: US-004 - Add double-click rename to open tabs in sidebar`
- **Typecheck**: Passes cleanly
---

## 2026-02-17 - US-005
- Added panelColor field to Settings interface (string) and Workspace interface (optional string) in types.ts
- Added panelColor: '' default to DEFAULT_SETTINGS in constants.ts
- No schema migration needed — panelColor is optional on Workspace and getSettings() spreads defaults over stored values
- Files changed: src/shared/types.ts, src/shared/constants.ts
- **Learnings for future iterations:**
  - Settings defaults are in constants.ts (DEFAULT_SETTINGS), not in settingsStorage.ts — getSettings() merges stored values over defaults via spread
  - Adding an optional field to Workspace requires no migration since existing workspaces without the field will just have it as undefined
  - updateSettings() and updateWorkspace() both use Partial spread, so new fields "just work" for persistence
---

## Iteration 5 - Tue Feb 17 18:18:26 IST 2026
Tool: claude
Log: /Users/vaidhprakashchoudhary/Documents/Projects/Development/fun-projects/arc-flow/scripts/ralph/runs/20260217-180605/iter-5.log
---
**US-005 is complete.** There are still 10 stories with `passes: false` remaining (US-006 through US-015).

**Summary of US-005 completion:**
- **Feature**: Added `panelColor` data model support for panel background color customization
- **Changes**:
  - `Settings` interface: added `panelColor: string` field
  - `Workspace` interface: added optional `panelColor?: string` field
  - `DEFAULT_SETTINGS`: added `panelColor: ""` (empty string = use default dark theme background)
- **Storage**: No migration needed — `panelColor` is optional on Workspace (undefined for existing workspaces) and `getSettings()` merges defaults via spread
- **Files changed**: `src/shared/types.ts`, `src/shared/constants.ts`
- **Commit**: `136d27f` — `feat: US-005 - Add panelColor to Settings and Workspace types with storage support`
- **Typecheck & lint**: Pass cleanly
---

## 2026-02-17 - US-006
- Added applyPanelColor() function to useTheme.ts that sets --color-arc-panel-bg and --color-arc-panel-bg-secondary CSS variables
- Secondary variant auto-computed as 10% lighter using lightenColorByPercent()
- Added getLuminance() function for relative luminance calculation — adds 'light-panel' class when luminance > 0.5
- Empty color string removes CSS variables (falls back to CSS defaults defined in @theme block)
- useTheme hook calls applyPanelColor on mount with stored settings.panelColor
- useTheme hook listens to chrome.storage.onChanged for settings.panelColor updates
- Added --color-arc-panel-bg and --color-arc-panel-bg-secondary to index.css @theme block with default dark values
- Updated App.tsx main container and SettingsPanel.tsx to use dark:bg-[var(--color-arc-panel-bg)] instead of dark:bg-arc-bg
- Files changed: src/sidepanel/useTheme.ts, src/sidepanel/index.css, src/sidepanel/App.tsx, src/sidepanel/SettingsPanel.tsx
- **Learnings for future iterations:**
  - applyPanelColor is exported (not just internal) so SettingsPanel can call it directly for immediate feedback when user picks a color
  - The dark:bg-[var(--color-arc-panel-bg)] Tailwind arbitrary value syntax works for referencing CSS variables in dark mode
  - Default panel bg values in @theme block match the original arc-bg (#0f0f17) so no visual change until user customizes
  - lightenColorByPercent() is a more flexible version of lightenColor() — takes a percent parameter (0.1 = 10%, 0.2 = 20%)
---
